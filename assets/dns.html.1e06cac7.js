import{_ as c}from"./dns_flowchart_20210418.c4d2d3a7.js";import{_ as d,r as a,o as l,c as u,a as e,b as n,w as t,d as s,e as i}from"./app.475aa88c.js";const p={},h=e("h1",{id:"dns-server",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#dns-server","aria-hidden":"true"},"#"),s(" DNS Server")],-1),m=e("p",null,"V2Ray has a built-in DNS server, which has two main purposes: matching routing rules according to the IP resolved from a domain, and traditional DNS function\u2014resolving the target address to connect.",-1),v={class:"custom-container tip"},f=e("p",{class:"custom-container-title"},"TIP",-1),b=s("Due to the complexity of DNS protocol, V2Ray only supports basic IP query function (A and AAAA records). In order to have a complete DNS experience, you may want to use an dedicated DNS serverware, such as "),g={href:"https://coredns.io",target:"_blank",rel:"noopener noreferrer"},q=s("CoreDNS"),k=s(", together with V2Ray's builtin DNS features."),_=i('<div class="custom-container warning"><p class="custom-container-title">WARNING</p><p>For <code>outbound</code>s with <code>freedom</code> protocol, the default value of <code>domainStrategy</code> is <code>AsIs</code>, therefore the DNS settings will not be applied to this outbound by default. If necessary, it should be configured as<code>UseIP</code>.</p></div><h2 id="dns-processing-flow" tabindex="-1"><a class="header-anchor" href="#dns-processing-flow" aria-hidden="true">#</a> DNS processing flow</h2><p>When a domain name list assigned by a DNS server matches the domain name currently being queried, V2Ray will use this DNS server first, otherwise, it will query from top to bottom, and only return the IP list which matches expectIPs. The processing flow diagram of the DNS server is as follows:</p><p><img src="'+c+`" alt=""></p><h2 id="dnsobject" tabindex="-1"><a class="header-anchor" href="#dnsobject" aria-hidden="true">#</a> DnsObject</h2><p><code>DnsObject</code> corresponds to the <code>dns</code> field of the configuration file.</p><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;hosts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;baidu.com&quot;</span><span class="token operator">:</span> <span class="token string">&quot;127.0.0.1&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;servers&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">{</span>
            <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.2.3.4&quot;</span><span class="token punctuation">,</span>
            <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">5353</span><span class="token punctuation">,</span>
            <span class="token property">&quot;domains&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;domain:v2ray.com&quot;</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token property">&quot;expectIPs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                <span class="token string">&quot;geoip:cn&quot;</span>
            <span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string">&quot;8.8.8.8&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;8.8.4.4&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;localhost&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;clientIp&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.2.3.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;tag&quot;</span><span class="token operator">:</span> <span class="token string">&quot;dns_inbound&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><code>hosts</code>: map{string: address}</p></blockquote><p>Static IP list, its value is a series of &quot;domain name&quot;: &quot;address&quot;. The address can be an IP or domain name. When resolving a domain name, if the domain name matches an item in this list when the address of the item is an IP, the resolution result is the IP of the item, and the following servers are not used for resolution; when the address is a domain name, this domain name will be used for IP resolution instead of the original domain name.</p><p>The domain name format has the following forms:</p>`,10),y=e("li",null,'Pure string: When this domain name completely matches the target domain name, the rule takes effect. For example, "v2ray.com" matches "v2ray.com" but not "www.v2ray.com".',-1),w=e("li",null,[s("Regular expression: Start with "),e("code",null,'"regexp:"'),s(', and the rest is a regular expression. When this regular expression matches the target domain name, the rule takes effect. For example, "regexp:\\\\.goo.*\\\\.com$" matches "www.google.com" and "fonts.googleapis.com" but not "google.com".')],-1),S=e("li",null,[s("Subdomain (recommended): Start with "),e("code",null,'"domain:"'),s(', and the rest part is a domain name. This rule takes effect when the domain name is the target domain name or its subdomain name. For example, "domain:v2ray.com" matches "www.v2ray.com", "v2ray.com", but not "xv2ray.com".')],-1),D=e("li",null,[s("Substring: Start with "),e("code",null,'"keyword:"'),s(', and the rest part is a string. When this string matches any part of the target domain name, the rule takes effect. For example, "keyword:sina.com" can match "sina.com", "sina.com.cn" and "www.sina.com" but not "sina.cn".')],-1),N=s("List of predefined domain names: Start with "),I=e("code",null,'"geosite:"',-1),x=s(", and the rest is a name, such as "),P=e("code",null,"geosite:google",-1),R=s(" or "),j=e("code",null,"geosite:cn",-1),V=s(". For the name and domain name list, please refer to "),T=s("Predefined Domain Name List"),O=s("."),W=i(`<blockquote><p><code>servers</code>: [string | <a href="#serverobject">ServerObject</a> ]</p></blockquote><p>A list of DNS servers, supporting two types: DNS address (string format) and <a href="#serverobject">ServerObject</a>. When its value is a DNS IP address, such as <code>&quot;8.8.8.8&quot;</code>, V2Ray will use port 53 of this address for DNS query.</p><p>When the value is <code>&quot;localhost&quot;</code>, it means the machine&#39;s preset DNS configuration is used. When the value is in the form of <code>&quot;https://host:port/dns-query&quot;</code>, such as <code>&quot;https://dns.google/dns-query&quot;</code>, V2Ray will use <code>DNS over HTTPS</code> (RFC8484, short for DOH) to query. Some service providers have certificates of IP aliases, then you can write IP format directly, such as <code>https://1.1.1.1/dns-query</code>. You can also use non-standard ports and paths, such as <code>&quot;https://a.b.c.d:8443/my-dns-query&quot;</code> (4.22.0+).</p><p>When the value is in the form of <code>&quot;https+local://host:port/dns-query&quot;</code>, such as <code>&quot;https+local://dns.google/dns-query&quot;</code>, V2Ray will use <code>DOH local mode</code> for queries, that is, DOH requests will not go through Routing/Outbound and other components, but directly request externally to improve timing. Generally suitable for use on the server side. Non-standard ports and paths can also be used. (4.22.0+)</p><div class="custom-container tip"><p class="custom-container-title">TIP</p><p>When using <code>localhost</code>, the DNS request of this machine is not controlled by V2Ray, and additional configuration is needed to make DNS request forwarded by V2Ray.</p><p>The DNS clients initialized by different rules will be reflected in the V2Ray startup log with an <code>info</code> level, such as <code>local DOH</code>, <code>remote DOH</code> and <code>udp</code> and other modes. (4.22.0+)</p></div><blockquote><p><code>clientIp</code>: string</p></blockquote><p>The IP address of the current system. It is used to inform server the client&#39;s location during DNS queries. It cannot be a private address.</p><blockquote><p><code>tag</code>: string</p></blockquote><p>(V2Ray 4.13+) The query traffic sent by this DNS, except <code>localhost</code> and <code>DOHL_</code> modes, will carry this identifier, which can be matched with <code>inboundTag</code> in the routing.</p><h2 id="serverobject" tabindex="-1"><a class="header-anchor" href="#serverobject" aria-hidden="true">#</a> ServerObject</h2><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;address&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.2.3.4&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;port&quot;</span><span class="token operator">:</span> <span class="token number">5353</span><span class="token punctuation">,</span>
    <span class="token property">&quot;domains&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;domain:v2ray.com&quot;</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;expectIPs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;geoip:cn&quot;</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><code>address</code>: address</p></blockquote><p>DNS server address, such as <code>&quot;8.8.8.8&quot;</code>. For ordinary DNS IP addresses that only support the UDP protocol DNS server, if the address is in the form of a URL beginning with <code>&quot;https://&quot;</code> or <code>&quot;https+local://&quot;</code>, DOH mode is used, and the rules are the same as DOH configuration in string mode.</p><blockquote><p><code>port</code>: number</p></blockquote><p>DNS server port, such as <code>53</code>. This item defaults to <code>53</code> by default. When using DOH mode, this item is invalid, non-standard port should be specified in URL.</p><blockquote><p><code>domains</code>: [string]</p></blockquote>`,16),A=s("A list of domain names. The domain names contained in this list will be queried by this server first. The domain name format is the same as it in "),H=s("Routing Configuration"),L=s("."),F=e("blockquote",null,[e("p",null,[e("code",null,"expectIPs"),s(":[string]")])],-1),U=s("(V2Ray 4.22.0+) A list of IP ranges, the format is the same as it in "),C=s("route configuration"),B=s("."),E=e("p",null,"When this option is configured, V2Ray DNS will verify the returned IP and only return addresses in the expectIPs list.",-1),G=e("p",null,"If this item is not configured, the IP address will be returned as it is.",-1);function z(Y,$){const r=a("ExternalLinkIcon"),o=a("RouterLink");return l(),u("div",null,[h,m,e("div",v,[f,e("p",null,[b,e("a",g,[q,n(r)]),k])]),_,e("ul",null,[y,w,S,D,e("li",null,[N,I,x,P,R,j,V,n(o,{to:"/en_US/config/routing.html#dlc"},{default:t(()=>[T]),_:1}),O])]),W,e("p",null,[A,n(o,{to:"/en_US/config/routing.html#ruleobject"},{default:t(()=>[H]),_:1}),L]),F,e("p",null,[U,n(o,{to:"/en_US/config/routing.html#ruleobject"},{default:t(()=>[C]),_:1}),B]),E,G])}const M=d(p,[["render",z],["__file","dns.html.vue"]]);export{M as default};
